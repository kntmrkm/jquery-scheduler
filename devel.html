<!DOCTYPE html>
<html>
<head>
<title>jquery-schedule demo</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="bower_components/jquery/dist/jquery.min.js" type="text/javascript" language="javascript"></script>
<script src="bower_components/jquery-ui/jquery-ui.min.js" type="text/javascript" language="javascript"></script>
<link rel="stylesheet" type="text/css" href="bower_components/jquery-ui/themes/base/resizable.css" />

<script type="text/javascript" src="js/jquery-scheduler.js"></script>
<link rel="stylesheet" type="text/css" href="css/jquery-scheduler.css" />

<link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<style>
  body {
    padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
  }
</style>
<script type="text/javascript">
  $(document).ready(function(){
    init_scheduler = function(data) {
      $('#scheduler').empty();
      var $sc = $("#scheduler").timeSchedule({
        startTime: data.start_time, // schedule start time(HH:ii)
        endTime: data.end_time,   // schedule end time(HH:ii)
        timeUnit: data.time_unit,  // cell timestamp 10 minutes
        timeUnitWidth: 30,
        timeLineHeight: 50,   // height(px)
        debug: "#debug",   // debug string output elements
        headerTitle: 'header',
        dataWidth: 200,
        rows: data.rows,
        change: function (node, scheduleData, resource_id) {
          //console.log(revertStringTime(data.start));
          var url, params;
          url = 'http://lvh.me:3000/reservations/' + scheduleData.data.token + '/modify'
          params = {
            _method: 'patch'
          };
          params['reservation'] = {
            modify_by_timeline: true,
            name: '',
            start_time: revertStringTime(scheduleData.start),
            minutes: ((scheduleData.end - scheduleData.start) / 60),
            facility_id: resource_id
          };
          $.ajax({
            type: 'PATCH',
            url: url,
            data: params
          }).done(function(data, status, xhr){
            console.log(xhr.status);
          }).fail(function(data, status, xhr, error){
            fetch_schedule();
            console.log(data);
            //scheduleData.result = 'error';
          });
        },
        init_data: function (node, data) {
        },
        click: function (node, data) {
          //alert("click event");
        },
        append: function (node, data) {
        },
        time_click: function (time, data) {
          console.log('time click');
        },
        title_click: function() {
          console.log('title click');
        }
      });
    }

    /*fetch_schedule = function() {
      $.ajax({
        type: 'GET',
        url: 'http://lvh.me:3000/schedule/index.json?domain_name=izakaya',
        dataType: 'json',
        success: function (data) {
          //console.log(JSON.stringify(data));
          init_scheduler(data);
        }
      });
    };
    fetch_schedule();*/

    fetch_schedule = function() {
      var data;
      data = {
        rows: [{
          title : 'Title Area',
          subtitle: 'subtitle',
          resource_id: 1,
          resource_name: 'Resource',
          class: 'resource_class',
          id: 'resource_id_1',
          clickable: true,
          schedule:[
            {
              start:'14:00',
              end:'15:00',
              text:'Text Area',
              class: 'bar_class',
              data:{
                id: '999',
                token: 'token'
              }
            },
            {
              start:'11:00',
              end:'14:00',
              text:'Text Area',
              data:{
              }
            }
          ],
          time: [
            { time: '09:00', text: '予約不可', clickable: false },
            { time: '10:00', text: 'disabled', clickable: true }
          ]
        },
        {
          title : 'Title Area',
          resource_id: 2,
          resource_name: 'Resource',
          class: 'resource_class',
          id: 'resource_id_1',
          schedule:[
            {
              start:'16:00',
              end:'17:00',
              text:'Text Area',
              data:{
              }
            }
          ]
        }],
        start_time: '9:00',
        end_time: '24:00',
        time_unit: 900
      };
      init_scheduler(data);
    };

    fetch_schedule();


  });
</script>
</head>
<body>
  <div class="container">
    <div class="sc_wrapper">
      <div id="scheduler"></div>
    </div>
    <h2 id="option">Option</h2>
    <p>
      <table class="table table-striped">
      <tr>
      <th colspan="2">name</th>
      <th width="80">Type</th>
      <th>description</th>
      </tr>
      <tr>
      <td colspan="2">startTime</td>
      <td>String(HH:ii)</td>
      <td>schedule start time</td>
      </tr>
      <tr>
      <td colspan="2">endTime</td>
      <td>String(HH:ii)</td>
      <td>schedule end time</td>
      </tr>
      <tr>
      <td colspan="2">widthTime</td>
      <td>Integer</td>
      <td>minuite time line cell</td>
      </tr>
      <tr>
      <td colspan="2">timeLineY</td>
      <td>Integer</td>
      <td>cell height px</td>
      </tr>
      <tr>
      <td colspan="2">verticalScrollbar</td>
      <td>Integer</td>
      <td>scrollbar (px)</td>
      </tr>
      <tr>
      <td colspan="2">timeLineBorder</td>
      <td>Integer</td>
      <td>border(top and bottom)</td>
      </tr>
      <tr>
      <td colspan="2">debug</td>
      <td>String,element</td>
      <td>debug string output elements</td>
      </tr>
      <tr>
      <td rowspan="3">rows</td>
      <td></td>
      <td>Array</td>
      <td>Schedule Data</td>
      </tr>
      <tr>
      <td>title</td>
      <td>String</td>
      <td>Schedule Left Cell Text</td>
      </tr>
      <tr>
      <td>schedule</td>
      <td>Array</td>
      <td>Schedule Cell Data</td>
      </tr>
      <tr>
      <td colspan="2">change</td>
      <td>function</td>
      <td>callback change time</td>
      </tr>
      <tr>
      <td colspan="2">click</td>
      <td>function</td>
      <td>callback click time</td>
      </tr>
      <tr>
      <td colspan="2">time_click</td>
      <td>function</td>
      <td>callback timebar click</td>
      </tr>
      <tr>
      <td colspan="2">append</td>
      <td>function</td>
      <td>callback append time</td>
      </tr>
      </table>
    </p>

    <h2 id="option">Schedule Data</h2>
    <p>
      <table class="table table-striped">
      <tr>
      <th colspan="2">name</th>
      <th width="80">Type</th>
      <th>description</th>
      </tr>
      <tr>
      <td colspan="2">title</td>
      <td>String</td>
      <td>Visible Text Schedule Bar</td>
      </tr>
      <tr>
      <td colspan="2">class</td>
      <td>String</td>
      <td>add class name</td>
      </tr>
      <tr>
      <td rowspan="5">schedule</td>
      <td colspan="2">array</td>
      <td>add schedule data</td>
      </tr>
      <tr>
      <td>start</td>
      <td>String</td>
      <td>time String(HH:ii)</td>
      </tr>
      <tr>
      <td>end</td>
      <td>String</td>
      <td>time String(HH:ii)</td>
      </tr>
      <tr>
      <td>text</td>
      <td>String</td>
      <td>Show Text</td>
      </tr>
      <tr>
      <td>data</td>
      <td>Object,Array</td>
      <td>callback data Object</td>
      </tr>
      </table>
    </p>
  </div>  <!-- /container -->
  <div id="footer">
  <div class="container">
  <p class="muted credit">Copyright © 2014 <a href="https://github.com/ateliee" target="_blank">ateliee</a> inc. All Rights Reserved.</p>
  </div>
  </div>
  </div>
</body>
</html>
